%%%%%%%%%%%%%%%%
%   Discrete Fourier Transform of beam vibration
%   data to find fundamental frequency of vibration
%
%   By: Ian O'Hara
%   Date: 2/15/2011
%   Base idea of code taken from mathworks (fft() help page)

function [freq, amplitude] = fftTrussTest(csvDir)

if (exist(csvDir,'file') ~= 7)
    disp(sprintf('fftTrussTest: The Directory "%s" does not exist.',csvDir));
    freq = -1;
    amplitude = -1;
    return;
end

close all;

[status, result] = system(['perl formatScopeData.pl ' csvDir '/']);

numFile = [csvDir '/Numerical.csv'];
setFile = [csvDir '/Settings.csv'];

if (exist(numFile,'file') ~= 2)
   fprintf('fftTrustTest: Numerical.csv does not exist in specified directory. Perl script failure.\n');
   freq = -1;
   amplitude = -1;
   return;
end

numData = csvread(numFile);
settings = csvread(setFile);

numSamples = settings(1);      % Number of samples
sampleInterval = settings(2);  % Time between samples [s]
trigPoint = settings(3);       % Not entirely sure what this is.
vertScale = settings(6);       % Volts/1 count
vertOffset = settings(7);      % Volts
horScale = settings(9);        % Seconds/1 count

% Some derived data
sampleTime = numSamples*sampleInterval - sampleInterval;   % [s]
sampleRate = 

NFFT = 2^nextpow2(recordLen); % Next power of 2 from length of y
Y = fft(voltAmplitude,NFFT)/recordLen;
freq = sampleRate/2*linspace(0,1,NFFT/2+1);
figure(1);

%Plot single-sided amplitude spectrum.
plot(freq,2*abs(Y(1:NFFT/2+1))) ;
title('Single-Sided Amplitude Spectrum of y(t)');
xlabel('Frequency (Hz)');
ylabel('|Y(f)|');


figure(2);
plot(time,voltAmplitude);
end